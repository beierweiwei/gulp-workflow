<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>gulp使用笔记</title>
	<link rel="stylesheet" href="../css/github-markdown.css">
	<style>
		.markdown-body {
			box-sizing: border-box;
			min-width: 200px;
			max-width: 980px;
			margin: 0 auto;
			padding: 45px;
		}

		@media (max-width: 767px) {
			.markdown-body {
				padding: 15px;
			}
		}
	</style>
</head>
<body>
	<div class="markdown-body">
	<h3 id="-watchify-browserify-">使用 watchify 加速 browserify 编译</h3>
<pre><code class="lang-javascript">var watchify = require(&#39;watchify&#39;);
var browserify = require(&#39;browserify&#39;);
var gulp = rquire(&#39;gulp&#39;);
var source = require(&#39;vinyl-soruce-stream&#39;);
var buffer = rquire(&#39;vinyl-buffer&#39;);
var gutil = rquire(&#39;gulp-util&#39;);
var sourcemaps = rquire(&#39;gulp-sourcemaps&#39;);
var assign = rquire(&#39;loadsh.assign&#39;);

//这里添加自定义 browserify选项
var customOpts = {
    enteries: [&#39;./src/index.js&#39;],
    debug: true
}

var opts = assing({}, watchify.args, customOpts);
var b = watchify(browserify(opts));
//这里加入变换操作
比如： b.transform(coffeeify);

gulp.tast(&#39;js&#39;, bundle);//这样你就可以运行&#39;gulp js&#39;来编译文件
b.on(&#39;update&#39;, bundle);//当任何依赖发生改变时，运行打包工具
b.on(&#39;log&#39;, gutil.log);//输出编译日志到终端

function bundle(){
    return b.bundle()
    //记录错误
    .on(&#39;error&#39;, gutil.log.bind(gutil, &#39;Browserify Error&#39;))
    .pipe(source(&#39;bundle.js&#39;))
    //可选项，如果不需要缓存文件内容，就删除
    .pipe(buffer())
    .pipe(sourcemaps.init({loadMaps: true})) // 从 browserify 文件载入 map
    //在这里变换操作加入管道
    pipe(sourcemaps.write(&#39;./&#39;))//写入.map文件
    .pipe(gulp.dest(&#39;./dist&#39;));
}
</code></pre>
<h3 id="-">多数编译工具都是工厂函数的形式</h3>
<p>一个函数，接受一个对象参数。
对象包含了所有配置
对象可以通过Objeact.assing(),不断扩充，根据process...判断是否为生产环境，传递相应的参数</p>
<h3 id="what-is-vinyl">what is Vinyl</h3>
<p>Vinyl is a very simple metadata object that describes a file. When you think of a file, two attributes come to mind: path and contents. These are the main attributes on a Vinyl object. </p>
<h3 id="gulp-concat">gulp-concat</h3>
<pre><code class="lang-javascript">var concat = require(&#39;gulp-concat&#39;);

gulp.task(&#39;scripts&#39;, function() {
  return gulp.src([&#39;./lib/file3.js&#39;, &#39;./lib/file1.js&#39;, &#39;./lib/file2.js&#39;])
    .pipe(concat(&#39;all.js&#39;))
    .pipe(gulp.dest(&#39;./dist/&#39;));
});

var concat = require(&#39;gulp-concat&#39;);

gulp.task(&#39;scripts&#39;, function() {
  return gulp.src([&#39;./lib/file3.js&#39;, &#39;./lib/file1.js&#39;, &#39;./lib/file2.js&#39;])
    .pipe(concat({ path: &#39;new.js&#39;, stat: { mode: 0666 }}))
    .pipe(gulp.dest(&#39;./dist&#39;));
});

//&amp;sourcemaps

var gulp = require(&#39;gulp&#39;);
var concat = require(&#39;gulp-concat&#39;);
var sourcemaps = require(&#39;gulp-sourcemaps&#39;);

gulp.task(&#39;javascript&#39;, function() {
  return gulp.src(&#39;src/**/*.js&#39;)
    .pipe(sourcemaps.init())
      .pipe(concat(&#39;all.js&#39;))
    .pipe(sourcemaps.write())
    .pipe(gulp.dest(&#39;dist&#39;));
});
</code></pre>
<h3 id="gulp-tap">gulp-tap</h3>
<p>Some filters like gulp-coffee process all files. What if you want to process all JS and Coffee files in a single pipeline. Use tap to filter out .coffee files and process them through the coffee filter and let JavaScript files pass through.</p>
<pre><code class="lang-javascript">gulp.src(&quot;src/**/*.{coffee,js}&quot;)
    .pipe(tap(function(file, t) {
        if (path.extname(file.path) === &#39;.coffee&#39;) {
            return t.through(coffee, []);
        }
    }))
    .pipe(gulp.dest(&#39;build&#39;));
</code></pre>

	</div>
</body>
</html>